(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[374],{147:e=>{e.exports={button:"Button_button__exqP_",primary:"Button_primary__DEC_1",disabled:"Button_disabled__8r9g4",secondary:"Button_secondary__9ex2D",danger:"Button_danger__MnjLX",small:"Button_small__dvm_S",medium:"Button_medium__j0vFR",large:"Button_large__C72gW",icon:"Button_icon__r3wfm",label:"Button_label__ijedD",loading:"Button_loading__U3vY1",spinner:"Button_spinner__XcCkv",spin:"Button_spin__ITV3l"}},495:()=>{},2135:(e,t,s)=>{"use strict";s.d(t,{g:()=>F});var a=s(5155),n=s(2115),l=s(6874),o=s.n(l),r=s(2528),i=s(7055),d=s(9644),c=s(6732),u=s(6715),m=s(7257),p=s(4905),h=s(3721),g=s(7978),_=s(9300),f=s.n(_),v=s(4114),y=s.n(v);let x=e=>{let{onImageUpload:t,disabled:s=!1,size:n}=e;return(0,a.jsx)("div",{className:y().uploadContainer,children:(0,a.jsxs)("label",{className:f()(y().uploadIconButton,{[y().disabledUploadIconButton]:s,[y().smallUploadIconButton]:"small"===n}),children:[(0,a.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:t,disabled:s,className:y().hiddenFileInput}),(0,a.jsx)(g.To,{className:y().uploadIcon})]})})},b=e=>{let{uploadedImages:t,onRetryUpload:s,onRemoveImage:n}=e;return 0===t.length?null:(0,a.jsx)("div",{className:y().attachedImagesContainer,children:t.map(e=>(0,a.jsxs)("div",{className:y().previewImageContainer,children:["success"===e.status&&e.url&&(0,a.jsx)("img",{src:e.url,alt:"Uploaded image ".concat(e.id),className:y().previewImage}),"uploading"===e.status&&(0,a.jsx)("div",{className:y().previewImagePlaceholder,children:(0,a.jsx)("div",{className:y().spinner})}),"error"===e.status&&(0,a.jsx)("div",{className:y().previewImagePlaceholder,children:(0,a.jsx)("button",{className:y().retryButton,onClick:()=>s(e),title:e.errorMessage?"Error: ".concat(e.errorMessage,"\nClick to retry"):"Click to retry",children:"\uD83D\uDD01"})}),(0,a.jsx)("button",{onClick:()=>n(e.id),className:y().removeImageButton,title:"Remove image",disabled:"uploading"===e.status,children:"✕"})]},e.id))})},j=e=>{let{userPublicKey:t,getJWT:s}=e,[a,l]=(0,n.useState)(!1),[o,r]=(0,n.useState)([]),{uploadImage:i}=(0,d.P)(),{showErrorToast:u}=(0,c.d)(),m=o.filter(e=>"success"===e.status).map(e=>e.url),p=async e=>{if(!e.length)return;let a=e.map(e=>({id:crypto.randomUUID(),file:e,url:null,status:"uploading",errorMessage:null}));r(e=>[...e,...a]);let n=await s();if(!n||!t){u("Missing auth data. Please login again.");return}l(!0);let o=await Promise.allSettled(a.map(async e=>{try{let s=await i({imageFile:e.file,userPublicKey:t,jwt:n});return r(t=>t.map(t=>t.id===e.id?s.success?{...t,url:s.data.ImageURL,status:"success"}:{...t,status:"error",errorMessage:s.error||"Upload failed"}:t)),{success:s.success,fileName:e.file.name,error:s.error}}catch(s){let t=(null==s?void 0:s.message)||"Upload failed";return r(s=>s.map(s=>s.id===e.id?{...s,status:"error",errorMessage:t}:s)),{success:!1,fileName:e.file.name,error:t}}}));l(!1);let d=o.map(e=>e.value).filter(e=>e&&!e.success);if(d.length>0){if(1===d.length){let e=d[0];u('Failed to upload "'.concat(e.fileName,'": ').concat(e.error))}else u("Failed to upload ".concat(d.length," image").concat(d.length>1?"s":""))}};return{imageLoading:a,uploadedImages:o,successfulImageUrls:m,handleImageUpload:async e=>{let t=Array.from(e.target.files||[]);e.target.value="",await p(t)},handlePaste:async e=>{var t;let s=null===(t=e.clipboardData)||void 0===t?void 0:t.items;if(!s)return;let a=Array.from(s).filter(e=>"file"===e.kind&&e.type.startsWith("image/"));if(a.length>0){let e=a.map(e=>e.getAsFile()).filter(Boolean);await p(e)}},handlePastedText:async e=>{let t=e.trim();if(/^https?:\/\/.*\.(gif|webp)(\?.*)?$/i.test(t)||/tenor\.com|giphy\.com|media\.discordapp\.net/i.test(t))try{let e=await fetch(t);if(!e.ok){u("Failed to download GIF");return}let s=await e.blob();if(!s.type.startsWith("image/")){u("URL does not contain a valid image");return}let a="gif-".concat(Date.now(),".").concat(s.type.split("/")[1]||"gif"),n=new File([s],a,{type:s.type});await p([n])}catch(e){console.error("Error downloading GIF:",e),u("Failed to download GIF from URL")}},handleDrop:async e=>{e.preventDefault();let t=Array.from(e.dataTransfer.files).filter(e=>e.type.startsWith("image/"));t.length>0&&await p(t)},handleDragOver:e=>{e.preventDefault()},handleRetryUpload:async e=>{r(t=>t.map(t=>t.id===e.id?{...t,status:"uploading"}:t));let a=await s();try{let s=await i({imageFile:e.file,userPublicKey:t,jwt:a});if(s.success)r(t=>t.map(t=>t.id===e.id?{...t,url:s.data.ImageURL,status:"success",errorMessage:null}:t));else{let t=s.error||"Retry failed";r(s=>s.map(s=>s.id===e.id?{...s,status:"error",errorMessage:t}:s)),u('Retry failed for "'.concat(e.file.name,'": ').concat(t))}}catch(s){let t=(null==s?void 0:s.message)||"Retry failed";r(s=>s.map(s=>s.id===e.id?{...s,status:"error",errorMessage:t}:s)),u('Retry failed for "'.concat(e.file.name,'": ').concat(t))}},handleRemoveImage:e=>{r(t=>t.filter(t=>t.id!==e))},loadExistingImages:e=>{if(!(null==e?void 0:e.length)){r([]);return}r(e.map(e=>({id:crypto.randomUUID(),file:null,url:e,status:"success",errorMessage:null})))},clearImages:()=>{r([])}}};var w=s(5838),P=s(5299),C=s(4945),I=s(6492),N=s(5146);let D=(e,t)=>{let s=document.createElement("div"),a=window.getComputedStyle(e);s.style.position="absolute",s.style.visibility="hidden",s.style.whiteSpace="pre-wrap",s.style.wordWrap="break-word",s.style.width=e.offsetWidth+"px",s.style.font=a.font,s.style.padding=a.padding,s.style.border=a.border,s.style.lineHeight=a.lineHeight,s.style.letterSpacing=a.letterSpacing,document.body.appendChild(s),s.textContent=e.value.substring(0,t);let n=document.createElement("span");n.textContent="|",s.appendChild(n);let l={top:n.offsetTop,left:n.offsetLeft};return document.body.removeChild(s),l},U=e=>{let[t,s]=(0,n.useState)({isOpen:!1,query:"",startIndex:-1,endIndex:-1}),[a,l]=(0,n.useState)(0),[o,r]=(0,n.useState)(""),i=(0,n.useRef)(t);(0,n.useEffect)(()=>{i.current=t},[t]);let c=(0,n.useRef)({getBoundingClientRect:()=>{let t=i.current;if(!e.current||!t.isOpen||-1===t.startIndex)return{width:0,height:0,x:0,y:0,top:0,left:0,right:0,bottom:0};let s=e.current,a=s.getBoundingClientRect(),n=D(s,t.startIndex),l=n.top-s.scrollTop,o=n.left-s.scrollLeft,r=a.top+l,d=a.left+o;return{width:0,height:0,x:d,y:r,top:r,left:d,right:d,bottom:r}}}),{getProfiles:u}=(0,d.P)(),p=(0,n.useCallback)(()=>{s({isOpen:!1,query:"",startIndex:-1,endIndex:-1})},[]),{refs:h,floatingStyles:g}=(0,P.we)({placement:"bottom-start",middleware:[(0,C.cY)(e=>{let{placement:t}=e;return{mainAxis:25*!!t.startsWith("bottom"),crossAxis:0}}),(0,C.UU)({mainAxis:!0,padding:8}),(0,C.BN)(),(0,C.Ej)({apply:e=>{let{elements:t}=e;Object.assign(t.floating.style,{maxHeight:"200px",minWidth:"250px",overflowY:"auto"})}})],whileElementsMounted:I.ll});(0,n.useEffect)(()=>{let s=e.current;if(!s)return;let a=()=>{t.isOpen&&p()};return s.addEventListener("scroll",a),()=>s.removeEventListener("scroll",a)},[e,t.isOpen,p]),(0,N.L)([h.floating],()=>{t.isOpen&&p()}),(0,n.useEffect)(()=>{let e=setTimeout(()=>{t.query.length>=2?r(t.query):r("")},300);return()=>clearTimeout(e)},[t.query]);let{data:_=[],isLoading:f}=(0,w.useQuery)({queryKey:m.lH.searchProfilesByUsernamePrefix(o),queryFn:async()=>{var e;let t=await u({UsernamePrefix:o,AddGlobalFeedBoolean:!1,FetchUsersThatHODL:!1,NumToFetch:8});if(!t.success)throw Error(t.error);return(null===(e=t.data)||void 0===e?void 0:e.ProfilesFound)||[]},enabled:!!o&&t.isOpen,staleTime:3e4,gcTime:3e5,retry:!1,refetchOnWindowFocus:!1});(0,n.useEffect)(()=>{l(0)},[_]);let v=(0,n.useCallback)((e,t)=>{let s=e.slice(0,t),a=s.match(/@([a-zA-Z0-9_]*)$/);if(a){let e=a[1],n=s.lastIndexOf("@");return{isOpen:e.length>=2,query:e,startIndex:n,endIndex:t}}return{isOpen:!1,query:"",startIndex:-1,endIndex:-1}},[]),y=(0,n.useCallback)((e,t)=>{let a=v(e,t);s(a),a.isOpen&&h.setReference(c.current)},[v,h]),x=(0,n.useCallback)((s,a,n)=>{if(!s||-1===t.startIndex)return;let l=a.slice(0,t.startIndex),o=a.slice(t.endIndex);n("".concat(l,"@").concat(s.Username," ").concat(o)),p(),setTimeout(()=>{if(e.current){let t=l.length+s.Username.length+2;e.current.focus(),e.current.setSelectionRange(t,t)}},0)},[t,e,p]),b=(0,n.useCallback)((e,s,n)=>{if(!t.isOpen||0===_.length)return!1;switch(e.key){case"ArrowDown":return e.preventDefault(),l(e=>Math.min(e+1,_.length-1)),!0;case"ArrowUp":return e.preventDefault(),l(e=>Math.max(e-1,0)),!0;case"Enter":case"Tab":return e.preventDefault(),_[a]&&x(_[a],s,n),!0;case"Escape":return e.preventDefault(),p(),!0;default:return!1}},[t.isOpen,_,a,x,p]);return{mentionState:t,profiles:_,isLoading:f,selectedIndex:a,setSelectedIndex:l,handleTextChange:y,handleKeyDown:b,insertMention:x,closeMentions:p,floatingStyles:g,refs:h}};var B=s(9987),L=s(5781),R=s(5117),S=s(6349),k=s.n(S);let E=e=>{let{isOpen:t,profiles:s,isLoading:n,selectedIndex:l,floatingStyles:o,floatingRef:r,onSelect:i,onHover:d}=e;return t?(0,a.jsx)(P.XF,{children:(0,a.jsx)("div",{ref:r,style:o,className:k().container,children:(0,a.jsx)(L.m,{className:k().dropdown,children:n?(0,a.jsx)("div",{className:k().message,children:"Searching..."}):s.length>0?s.map((e,t)=>(0,a.jsx)("div",{onMouseEnter:()=>d(t),children:(0,a.jsxs)(R.D,{onClick:()=>i(e),checked:t===l,icon:(0,a.jsx)(B.e,{profile:e,size:24}),children:["@",e.Username]})},e.PublicKeyBase58Check)):(0,a.jsx)("div",{className:k().message,children:"No users found"})})})}):null};var O=s(4549),T=s.n(O);let F=e=>{let{mode:t="create",quotedPost:s=null,editablePost:l=null,disabled:g=!1,userPublicKey:_=null,userProfile:v=null,ParentStakeID:y=null,isComment:w=!1,onReply:P,onClose:C}=e,I=(0,r.A)(),N=(0,i.J)(),D=_||I.userPublicKey,B=v||N.userProfile,L=I.signAndSubmitTransaction,{submitPost:R}=(0,d.P)(),{showErrorToast:S,showSuccessToast:k}=(0,c.d)(),O=(0,u.useQueryClient)(),[F,M]=(0,n.useState)(""),[H,A]=(0,n.useState)(!1),W=(0,n.useRef)(null),{imageLoading:Q,uploadedImages:q,successfulImageUrls:V,handleImageUpload:G,handlePaste:z,handleDrop:K,handleDragOver:Y,handleRetryUpload:J,handleRemoveImage:$,loadExistingImages:Z,clearImages:X}=j({userPublicKey:D,getJWT:I.getIdentityJWT}),{mentionState:ee,profiles:et,isLoading:es,selectedIndex:ea,setSelectedIndex:en,handleTextChange:el,handleKeyDown:eo,insertMention:er,closeMentions:ei,floatingStyles:ed,refs:ec}=U(W);(0,n.useEffect)(()=>{"quote"===t&&s?(M(""),X()):"edit"===t&&l?(M(l.Body||""),Z(l.ImageURLs)):(M(""),X())},[t,s,l]);let eu=e=>{M(e)},em=async()=>{A(!0);try{var e,n;let r={UpdaterPublicKeyBase58Check:D,...w&&y&&{ParentStakeID:y},..."quote"===t&&s&&{RepostedPostHashHex:null==s?void 0:null===(e=s.post)||void 0===e?void 0:e.PostHashHex},..."edit"===t&&l&&{PostHashHexToModify:l.PostHashHex},BodyObj:{Body:F,...V.length>0&&{ImageURLs:V}},MinFeeRateNanosPerKB:1500},i=await R(r);if(i.error){S("Failed to submit post: ".concat(i.error));return}if(i.success&&(null===(n=i.data)||void 0===n?void 0:n.TransactionHex)){let e=(null==B?void 0:B.Username)||D,s=await L(i.data.TransactionHex);w||await O.invalidateQueries({queryKey:m.lH.userPosts(e)}),w||k((0,a.jsxs)("div",{children:[(()=>{switch(t){case"quote":return"Quote posted successfully \uD83C\uDF89";case"edit":return"Post updated successfully ✨";default:return"Post published successfully \uD83C\uDF89"}})(),(0,a.jsx)("br",{}),(0,a.jsx)(o(),{href:"/".concat(e,"/posts/"),children:"View in Posts"})]}),{autoClose:7e3}),M(""),X(),ei(),P&&P(null==s?void 0:s.PostEntryResponse),C&&C()}}catch(t){let e=(null==t?void 0:t.message)||"Error submitting post";S("Failed to submit post: ".concat(e))}finally{A(!1)}},ep=()=>D?H?w?"Posting...":"quote"===t?"Quoting...":"edit"===t?"Updating...":"Posting...":w?"Reply":"quote"===t?"Quote Post":"edit"===t?"Update Post":"Post to DeSo":"Login to Post";return(0,a.jsxs)("div",{className:f()(T().postContainer,{[T().commentContainer]:w}),children:[(0,a.jsxs)("div",{className:T().textareaContainer,children:[(0,a.jsx)("textarea",{ref:W,name:w?"commentText":"postText",disabled:H||g||!D,value:F,onChange:e=>{let t=e.target.value,s=e.target.selectionStart;M(t),el(t,s)},onKeyDown:e=>{if(eo(e,F,eu))return},onSelect:e=>{el(F,e.target.selectionStart)},onPaste:z,onDrop:K,onDragOver:Y,placeholder:(()=>{if(!D)return"Login to start posting...";let e=(null==B?void 0:B.Username)||D;return w?"Reply as ".concat(e,"..."):"quote"===t?"Add your thoughts about this post as ".concat(e,"..."):"edit"===t?"Edit your post as ".concat(e,"..."):"Write a post as ".concat(e,"...")})()}),(0,a.jsx)(E,{isOpen:ee.isOpen,profiles:et,isLoading:es,selectedIndex:ea,floatingStyles:ed,floatingRef:ec.setFloating,onSelect:e=>{er(e,F,eu)},onHover:en})]}),(0,a.jsxs)("div",{className:T().postActions,children:[(0,a.jsx)("div",{className:T().uploadActions,children:(0,a.jsx)(x,{onImageUpload:G,disabled:!D,size:w?"small":void 0})}),w?(0,a.jsxs)("div",{className:T().actionButtons,children:[(0,a.jsx)(p.$,{onClick:C,disabled:H,variant:"secondary",size:"small",className:T().commentBtn,children:"Cancel"}),(0,a.jsx)(p.$,{onClick:em,isLoading:H,disabled:!F.trim()&&0===q.filter(e=>e.url).length||g||!D||Q,variant:"primary",size:"small",className:T().commentBtn,children:ep()})]}):(0,a.jsx)("div",{className:T().actionButtons,children:(0,a.jsx)(p.$,{disabled:!F.trim()&&0===q.filter(e=>e.url).length||g||!D||Q,isLoading:H,onClick:em,className:T().postButton,children:ep()})})]}),(0,a.jsx)(b,{uploadedImages:q,onRetryUpload:J,onRemoveImage:$}),s&&(0,a.jsx)(h.L,{post:null==s?void 0:s.post,username:null==s?void 0:s.username,userProfile:null==s?void 0:s.ProfileEntryResponse,isQuote:!0,isStatsDisabled:!0})]})}},2528:(e,t,s)=>{"use strict";s.d(t,{A:()=>i,O:()=>r});var a=s(5155),n=s(2115),l=s(2161);let o=(0,n.createContext)(null);function r(e){let{children:t}=e,[s,r]=(0,n.useState)(null),[i,d]=(0,n.useState)({}),[c,u]=(0,n.useState)(!0),m=(0,n.useRef)(!1);(0,n.useEffect)(()=>{m.current||(m.current=!0,(0,l.jK8)({spendingLimitOptions:{GlobalDESOLimit:.1*1e9,TransactionCountLimitMap:{SUBMIT_POST:"UNLIMITED"}},appName:"DeSo Next.js App"}),l.D_O.subscribe(e=>{let{currentUser:t,alternateUsers:s,event:a}=e;switch(console.log("Identity State:",e),console.log({alternateUsers:s}),a){case"LOGIN_START":break;case"SUBSCRIBE":case"LOGIN_END":case"CHANGE_ACTIVE_USER":case"LOGOUT_END":r((null==t?void 0:t.publicKey)||null),d(s||{}),u(!1)}}))},[]);let p=async()=>{await l.D_O.login().catch(e=>{console.log("Error: ",e),u(!1)})},h=async()=>{await l.D_O.logout().catch(e=>{console.log("Error: ",e),u(!1)})},g=async e=>await l.D_O.signTx(e),_=async e=>await l.D_O.submitTx(e),f=async e=>await l.D_O.signAndSubmit({TransactionHex:e}),v=async()=>await l.D_O.jwt();return(0,a.jsx)(o.Provider,{value:{userPublicKey:s,login:p,logout:h,setActiveUser:e=>{e&&l.D_O.setActiveUser(e)},altUsers:i,isAuthChecking:c,signTransaction:g,submitTransaction:_,signAndSubmitTransaction:f,getIdentityJWT:v},children:t})}let i=()=>(0,n.useContext)(o)},3023:(e,t,s)=>{"use strict";s.d(t,{$:()=>o,h:()=>r});var a=s(5155),n=s(2115);let l=(0,n.createContext)(),o=e=>{let{children:t}=e,[s,o]=(0,n.useState)(null),[r,i]=(0,n.useState)(null);return(0,a.jsx)(l.Provider,{value:{quotedPost:s,setQuotedPost:o,editablePost:r,setEditablePost:i,clearEditorState:()=>{o(null),i(null)}},children:t})},r=()=>(0,n.useContext)(l)},3721:(e,t,s)=>{"use strict";s.d(t,{L:()=>S});var a=s(5155),n=s(9644),l=s(6715),o=s(8822),r=s(6874),i=s.n(r),d=s(2115),c=s(8554),u=s(9987),m=s(7183),p=s(5695),h=s(2528),g=s(7055),_=s(3023),f=s(6732),v=s(7257),y=s(5299),x=s(4945),b=s(6492),j=s(5146),w=s(5781),P=s(5117),C=s(2135),I=s(9300),N=s.n(I),D=s(8487),U=s.n(D);let B=e=>{let{post:t,username:s,ProfileEntryResponse:o,isStatsDisabled:r,onReply:c}=e,{PostHashHex:u,CommentCount:m,LikeCount:I,DiamondCount:D,RepostCount:B,QuoteRepostCount:L}=t,R=(0,p.useRouter)(),[S,k]=(0,d.useState)(!1),[E,O]=(0,d.useState)(!1),[T,F]=(0,d.useState)(!1),[M,H]=(0,d.useState)(m),[A,W]=(0,d.useState)(B),[Q,q]=(0,d.useState)(L);(0,d.useEffect)(()=>{H(m),W(B),q(L)},[m,B,L]);let{userPublicKey:V,signAndSubmitTransaction:G}=(0,h.A)(),{userProfile:z}=(0,g.J)(),{setQuotedPost:K}=(0,_.h)(),{submitPost:Y}=(0,n.P)(),{showErrorToast:J,showSuccessToast:$}=(0,f.d)(),Z=(0,l.useQueryClient)(),{refs:X,floatingStyles:ee}=(0,y.we)({placement:"bottom-start",strategy:"fixed",middleware:[(0,x.cY)(4),(0,x.UU)(),(0,x.BN)(),(0,x.Ej)({apply:e=>{let{rects:t,elements:s}=e;Object.assign(s.floating.style,{width:"".concat(t.reference.width,"px")})}})],whileElementsMounted:b.ll});(0,j.L)([X.reference,X.floating],()=>{O(!1)});let et=async()=>{F(!0),O(!1);try{var e;let t=await Y({UpdaterPublicKeyBase58Check:V,RepostedPostHashHex:u,BodyObj:{},MinFeeRateNanosPerKB:1500});if(t.error||!(null===(e=t.data)||void 0===e?void 0:e.TransactionHex))throw Error(t.error||"Missing transaction hex");let s=await G(t.data.TransactionHex);if(null==s?void 0:s.PostEntryResponse){let e=(null==z?void 0:z.Username)||V;await Z.invalidateQueries({queryKey:v.lH.userPosts(e)}),W(e=>e+1),$((0,a.jsxs)("div",{children:["Reposted successfully \uD83C\uDF89",(0,a.jsx)("br",{}),(0,a.jsx)(i(),{href:"/".concat(e,"/posts/"),children:"View in Posts"})]}),{autoClose:7e3})}else J("Error submitting repost.")}catch(t){let e=(null==t?void 0:t.message)||"Error submitting repost";J("Failed to submit repost. ".concat(e))}finally{F(!1)}},es=async()=>{O(!1),K({post:t,username:s,ProfileEntryResponse:o}),R.push("/compose/post")};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:U().stats,children:[(0,a.jsxs)("span",{className:U().iconWrapper,children:[(0,a.jsx)("span",{onClick:V&&!r?()=>{k(e=>!e)}:void 0,style:{cursor:V&&!r?"pointer":"default"},title:V?"Reply to this post":"Login to reply",children:"\uD83D\uDCAC"}),M]}),(0,a.jsxs)("span",{className:U().iconWrapper,children:[(0,a.jsx)("span",{ref:X.setReference,onClick:V&&!r&&!T&&((null==t?void 0:t.Body)||(null==t?void 0:t.ImageURLs)||(null==t?void 0:t.VideoURLs))?()=>O(e=>!e):void 0,className:N()(U().repostIcon,{[U().reposting]:T,[U().disabled]:r||!V||!(null==t?void 0:t.Body)&&!(null==t?void 0:t.ImageURLs)&&!(null==t?void 0:t.VideoURLs)}),title:(()=>{var e,s;return V?(null==t?void 0:t.Body)||(null==t?void 0:null===(e=t.ImageURLs)||void 0===e?void 0:e.length)||(null==t?void 0:null===(s=t.VideoURLs)||void 0===s?void 0:s.length)?"Repost options":"Can't repost empty post":"Login to repost"})(),children:"\uD83D\uDD01"}),A+Q]}),E&&(0,a.jsx)(y.XF,{children:(0,a.jsx)("div",{ref:X.setFloating,style:ee,className:U().dropdownContainer,children:(0,a.jsxs)(w.m,{className:U().repostDropdown,children:[(0,a.jsx)(P.D,{onClick:et,children:"\uD83D\uDD01 Repost"}),(0,a.jsx)(P.D,{onClick:es,children:"\uD83D\uDCAD Quote"})]})})}),(0,a.jsxs)("span",{className:U().iconWrapper,children:[(0,a.jsx)("span",{children:"❤️"}),I]}),(0,a.jsxs)("span",{className:U().iconWrapper,children:[(0,a.jsx)("span",{children:"\uD83D\uDC8E"}),D]})]}),S&&(0,a.jsx)(C.g,{isComment:!0,ParentStakeID:u,onClose:()=>k(!1),onReply:e=>{H(e=>e+1),k(!1),c&&c(e)}})]})},L=e=>{let{Body:t,VideoURLs:s,showRaw:n}=e,l=e=>e.includes("iframe.videodelivery.net/"),o=e=>{try{let t=new URL(e);return"lvpr.tv"===t.hostname&&t.searchParams.has("v")}catch(e){return!1}},r=e=>{if(!e)return null;let t=e.match(/(?:youtube\.com\/(?:watch\?v=|shorts\/)|youtu\.be\/)([\w-]{11,})/);return t?t[1]:null},i=e=>{try{return new URL(e),!0}catch(e){return!1}},d=Array.from(new Set([...(e=>{let t;if(!e)return[];let s=/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:watch\?v=|shorts\/)|youtu\.be\/)([\w-]{11})/g,a=[];for(;t=s.exec(e);)a.push(t[1]);return a})(t),...(e=>Array.isArray(e)?e.map(r).filter(Boolean):[])(s)])),c=Array.isArray(s)?s.filter(e=>i(e)&&!r(e)):[];return(0,a.jsxs)(a.Fragment,{children:[!n&&(0,a.jsx)(a.Fragment,{children:d.length>0&&(0,a.jsx)("div",{className:U().videoGallery,children:d.map((e,t)=>(0,a.jsx)("iframe",{src:"https://www.youtube.com/embed/".concat(e),className:U().postVideoIframe,allow:"accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;",allowFullScreen:!0,loading:"lazy",title:"YouTube Video ".concat(t+1),style:{width:"100%",aspectRatio:"16/9",border:0}},e))})}),n&&s&&s.length>0&&(0,a.jsx)("div",{className:U().videoGallery,children:(0,a.jsx)("pre",{children:s.map(e=>"".concat(e,"\n")).join("")})}),!n&&(0,a.jsx)(a.Fragment,{children:c&&c.length>0&&(0,a.jsx)("div",{className:U().videoGallery,children:c.map((e,t)=>l(e)||o(e)?(0,a.jsx)("iframe",{src:e,className:U().postVideoIframe,allow:"accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;",allowFullScreen:!0,loading:"lazy",title:"Video ".concat(t+1),style:{width:"100%",aspectRatio:"16/9",border:0}},t):(0,a.jsx)("video",{src:e,controls:!0,className:U().postVideo,preload:"metadata",children:"Your browser does not support the video tag."},t))})})]})},R=e=>{let{ImageURLs:t=[],showRaw:s=!1}=e;return t&&0!==t.length?(0,a.jsx)("div",{className:U().imageGallery,children:s?(0,a.jsx)("pre",{children:t.map(e=>"".concat(e,"\n")).join("")}):(0,a.jsx)(a.Fragment,{children:t.map((e,t)=>(0,a.jsx)("img",{src:e,alt:"Post image ".concat(t+1),className:U().postImage,loading:"lazy"},e||t))})}):null},S=e=>{var t,s,r,p,h,g;let{post:_,username:f,userProfile:y,isQuote:x,isComment:b,isStatsDisabled:j=!1}=e;if(!_)return null;let{PostHashHex:w,Body:P,ImageURLs:C,VideoURLs:I,CommentCount:N,RepostedPostEntryResponse:D,PosterPublicKeyBase58Check:k,ProfileEntryResponse:E,TimestampNanos:O}=_,{getSinglePost:T}=(0,n.P)(),F=(0,l.useQueryClient)(),M=(0,d.useRef)(!1),[H,A]=(0,d.useState)(()=>{var e;return null!==(e=F.getQueryData(v.lT.rawVisible(w)))&&void 0!==e&&e}),W=f||(null==E?void 0:E.Username)||k||"Unknown",Q=(0,m.b)(W),q=!Q&&W.startsWith("@")?W.slice(1):W,V=(null==E?void 0:null===(t=E.ExtraData)||void 0===t?void 0:t.DisplayName)||(null==y?void 0:null===(s=y.ExtraData)||void 0===s?void 0:s.DisplayName),[G,z]=(0,d.useState)(()=>{var e;return null!==(e=F.getQueryData(v.lT.commentsVisible(w)))&&void 0!==e&&e}),{data:K,fetchNextPage:Y,hasNextPage:J,isFetchingNextPage:$,isLoading:Z,refetch:X}=(0,o.useInfiniteQuery)({queryKey:v.lH.postComments(w),queryFn:async e=>{var t,s;let{pageParam:a=0}=e,n=await T({PostHashHex:w,CommentOffset:a,CommentLimit:10});if(!n.success)throw Error(n.error||"Failed to fetch comments");let l=(null===(s=n.data)||void 0===s?void 0:null===(t=s.PostFound)||void 0===t?void 0:t.Comments)||[],o=F.getQueryData(v.lH.postComments(w)),r=new Set((null==o?void 0:o.pages.flatMap(e=>e.comments.map(e=>e.PostHashHex)))||[]);return{comments:l.filter(e=>!r.has(e.PostHashHex)),nextOffset:a+10,hasMore:10===l.length}},getNextPageParam:(e,t)=>{var s,a,n;let l=(null===(n=t[0])||void 0===n?void 0:null===(a=n.comments)||void 0===a?void 0:null===(s=a.filter(e=>e.isLocal||e.isPromoted))||void 0===s?void 0:s.length)||0,o=t.flatMap(e=>e.comments).length-l;return e.hasMore?o:void 0},enabled:G,staleTime:1/0,gcTime:1/0,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1,retry:!1}),ee=(null==K?void 0:K.pages.flatMap(e=>e.comments))||[],et=(null===(g=F.getQueryData(v.lT.newCommentsVisible(w)))||void 0===g||g)&&(null==K?void 0:null===(h=K.pages)||void 0===h?void 0:null===(p=h[0])||void 0===p?void 0:null===(r=p.comments)||void 0===r?void 0:r.filter(e=>e.isLocal))||[];return(0,a.jsxs)("div",{className:"".concat(U().post," ").concat(x?U().quote:""," ").concat(b?U().comment:""),children:[!b&&(0,a.jsx)("div",{className:U().avatarContainer,children:(0,a.jsx)(u.e,{profile:E||y,size:48})}),(0,a.jsxs)("div",{className:U().postContentContainer,children:[(0,a.jsxs)("div",{className:U().header,children:[b?(0,a.jsx)(u.e,{profile:E||y,size:40}):(0,a.jsx)("div",{className:U().mobileAvatarContainer,children:(0,a.jsx)(u.e,{profile:E||y,size:45})}),(0,a.jsxs)("div",{className:U().postSummary,children:[(0,a.jsxs)("div",{className:U().postLinks,children:[(0,a.jsxs)("div",{className:U().userLinksWrapper,children:[V&&(0,a.jsx)(i(),{href:"/".concat(q),className:U().displayName,prefetch:!1,children:V}),Q?(0,a.jsx)(i(),{href:"/".concat(q),className:U().publicKey,prefetch:!1,children:q}):(0,a.jsxs)(i(),{href:"/".concat(q),className:U().username,prefetch:!1,children:["@",q]})]}),(0,a.jsx)("div",{className:U().postLinkWrapper,children:(0,a.jsxs)(i(),{href:"/".concat(q,"/posts/").concat(w),className:U().postLink,prefetch:!1,children:[O&&(0,a.jsxs)(a.Fragment,{children:[function(e){if(null==e||isNaN(Number(e)))return"Invalid date";let t=Number(e);if(!isFinite(t)||Math.abs(t)>864e19)return"Invalid date";let s=new Date(Math.floor(t/1e6));if(isNaN(s.getTime())||1970>s.getFullYear()||s.getFullYear()>3e3)return"Invalid date";try{let e=s.toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});return e=e.replace(",","")}catch(e){return s.toISOString().replace("T",", ").replace(/\.\d+Z$/,"")}}(O),". "]}),w]})})]}),(0,a.jsx)("div",{className:U().postControls,children:(P||C&&C.length>0)&&(0,a.jsx)("button",{onClick:()=>{A(e=>{let t=!e;return F.setQueryData(v.lT.rawVisible(w),t),t})},className:U().toggleRawButton,children:H?"Show Rendered \uD83D\uDCC4":"Show Raw \uD83D\uDCDD"})})]})]}),P&&(0,a.jsx)("div",{className:U().postBody,children:H?(0,a.jsx)("pre",{children:P.replace(/\\/g,"\\\\")}):(0,a.jsx)(c.R,{text:P})}),(0,a.jsx)(R,{ImageURLs:C,showRaw:H}),(0,a.jsx)(L,{Body:P,VideoURLs:I,showRaw:H}),D&&(0,a.jsx)("div",{className:U().repost,children:(0,a.jsx)(S,{post:D,isQuote:!0,isStatsDisabled:j})}),(0,a.jsx)(B,{post:_,username:f,ProfileEntryResponse:y,isStatsDisabled:j,onReply:e=>{G||(M.current=!0);let t={...e,isLocal:!0};F.setQueryData(v.lH.postComments(w),e=>{if(!e)return{pages:[{comments:[t]}],pageParams:[null]};if(e.pages.some(e=>e.comments.some(e=>e.PostHashHex===t.PostHashHex)))return e;let s=e.pages[0];return{...e,pages:[{...s,comments:[t,...s.comments]},...e.pages.slice(1)]}})}}),!j&&(0,a.jsxs)(a.Fragment,{children:[N>0&&(0,a.jsx)("button",{onClick:()=>{let e=!G;if(F.setQueryData(v.lT.commentsVisible(w),e),e&&F.setQueryData(v.lT.newCommentsVisible(w),!0),z(e),!e){F.setQueryData(v.lH.postComments(w),e=>{if(!e)return;let t=e.pages[0],s=t.comments.filter(e=>e.isLocal),a=t.comments.filter(e=>!e.isLocal),n=[...s.map(e=>({...e,isLocal:void 0,isPromoted:!0})),...a];return{...e,pages:[{...t,comments:n},...e.pages.slice(1)]}});return}if(M.current){var t,s;M.current=!1;let e=F.getQueryData(v.lH.postComments(w)),a=(null==e?void 0:null===(s=e.pages)||void 0===s?void 0:null===(t=s[0])||void 0===t?void 0:t.comments)||[],n=a.filter(e=>e.isLocal);if(a.some(e=>!e.isLocal&&!e.isPromoted))F.setQueryData(v.lH.postComments(w),e=>{if(!e)return;let t=e.pages[0],s=t.comments.filter(e=>e.isLocal),a=t.comments.filter(e=>!e.isLocal),n=[...s.map(e=>({...e,isLocal:void 0,isPromoted:!0})),...a];return{...e,pages:[{...t,comments:n},...e.pages.slice(1)]}});else{let e=a.filter(e=>e.isPromoted);X().then(()=>{F.setQueryData(v.lH.postComments(w),t=>{if(!t)return;let s=new Set(t.pages.flatMap(e=>e.comments.map(e=>e.PostHashHex))),a=[...n.filter(e=>!s.has(e.PostHashHex)).map(e=>({...e,isLocal:void 0,isPromoted:!0})),...e.filter(e=>!s.has(e.PostHashHex)),...t.pages[0].comments];return{...t,pages:[{...t.pages[0],comments:a},...t.pages.slice(1)]}})})}}},className:U().repliesButton,children:Z?"Loading replies...":G?"Hide replies":"See replies..."}),!G&&et.length>0&&(0,a.jsx)("div",{className:U().repliesContainer,children:(0,a.jsx)("div",{className:U().replies,children:et.map(e=>(0,a.jsx)(S,{post:e,isComment:!0},e.PostHashHex))})}),G&&(0,a.jsxs)("div",{className:U().repliesContainer,children:[(0,a.jsx)("div",{className:U().replies,children:ee.map(e=>(0,a.jsx)(S,{post:e,isComment:!0},e.PostHashHex))}),J&&(0,a.jsx)("button",{onClick:Y,disabled:$,className:U().loadMoreButton,children:$?"Loading more...":"Load more replies"})]})]})]})]})}},4114:e=>{e.exports={uploadContainer:"ImageUpload_uploadContainer__l4euf",hiddenFileInput:"ImageUpload_hiddenFileInput___uup2",uploadIconButton:"ImageUpload_uploadIconButton__W_vWF",smallUploadIconButton:"ImageUpload_smallUploadIconButton__yEclo",disabledUploadIconButton:"ImageUpload_disabledUploadIconButton__9_xxF",uploadIcon:"ImageUpload_uploadIcon__bWMUS",attachedImagesContainer:"ImageUpload_attachedImagesContainer__ypDmu",previewImageContainer:"ImageUpload_previewImageContainer__i3KyE",previewImage:"ImageUpload_previewImage__3idya",removeImageButton:"ImageUpload_removeImageButton__kbNbn",previewImagePlaceholder:"ImageUpload_previewImagePlaceholder__DS8SF",spinner:"ImageUpload_spinner__NzpzU",spin:"ImageUpload_spin__DPuLr",retryButton:"ImageUpload_retryButton___2jJV"}},4549:e=>{e.exports={postContainer:"PostEditor_postContainer__v2b8J",commentContainer:"PostEditor_commentContainer__pxYgQ",postActions:"PostEditor_postActions__JS0yS",uploadActions:"PostEditor_uploadActions__OkWdD",actionButtons:"PostEditor_actionButtons__QEZva",error:"PostEditor_error__RvbQJ",commentBtn:"PostEditor_commentBtn__3lMi0",postButton:"PostEditor_postButton__iXF4l",textareaContainer:"PostEditor_textareaContainer__hoA1U"}},4905:(e,t,s)=>{"use strict";s.d(t,{$:()=>m});var a=s(5155),n=s(8637),l=s.n(n),o=s(6874),r=s.n(o),i=s(147),d=s.n(i),c=s(9300),u=s.n(c);let m=e=>{let{children:t,type:s="button",variant:n="primary",size:l="medium",disabled:o=!1,isLoading:i=!1,icon:c=null,trailingIcon:m=null,href:p=null,as:h=null,onClick:g,className:_,...f}=e,v=u()(d().button,d()[n],d()[l],{[d().loading]:i,[d().disabled]:o||i},_),y=(0,a.jsxs)(a.Fragment,{children:[i?(0,a.jsx)("span",{className:d().spinner,"aria-hidden":"true"}):c&&(0,a.jsx)("span",{className:d().icon,children:c}),(0,a.jsx)("span",{className:d().label,children:t}),!i&&m&&(0,a.jsx)("span",{className:d().icon,children:m})]});return p?(0,a.jsx)(r(),{href:o||i?"#":p,className:v,onClick:e=>{if(o||i){e.preventDefault();return}g&&g(e)},"aria-disabled":o||i,...f,children:y}):h?(0,a.jsx)(h,{className:v,onClick:e=>{if(o||i){e.preventDefault();return}g&&g(e)},"aria-disabled":o||i,role:"button",tabIndex:o||i?-1:0,...f,children:y}):(0,a.jsx)("button",{type:s,className:v,disabled:o||i,onClick:g,...f,children:y})};m.propTypes={children:l().node.isRequired,type:l().oneOf(["button","submit","reset"]),variant:l().oneOf(["primary","secondary","danger"]),size:l().oneOf(["small","medium","large"]),disabled:l().bool,isLoading:l().bool,icon:l().node,trailingIcon:l().node,href:l().string,as:l().elementType,className:l().string},m.defaultProps={type:"button",variant:"primary",size:"medium",disabled:!1,isLoading:!1,icon:null,trailingIcon:null,href:null,as:null,className:void 0}},5117:(e,t,s)=>{"use strict";s.d(t,{D:()=>c});var a=s(5155),n=s(8637),l=s.n(n),o=s(9300),r=s.n(o),i=s(5191),d=s.n(i);let c=e=>{let{children:t,size:s="medium",icon:n=null,trailingIcon:l=null,checked:o=!1,disabled:i=!1,variant:c="default",onClick:u}=e;return(0,a.jsxs)("div",{className:r()(d().menuItem,d()[s],d()[c],{[d().disabled]:i,[d().checked]:o}),onClick:i?void 0:u,role:"menuitem",tabIndex:i?-1:0,"aria-disabled":i,children:[n&&(0,a.jsx)("span",{className:d().icon,children:n}),(0,a.jsx)("span",{className:d().label,children:t}),l&&(0,a.jsx)("span",{className:d().trailingIcon,children:l})]})};c.propTypes={children:l().node.isRequired,size:l().oneOf(["small","medium","large"]),icon:l().node,trailingIcon:l().node,checked:l().bool,disabled:l().bool,variant:l().oneOf(["default","danger"]),onClick:l().func},c.defaultProps={size:"medium",icon:null,trailingIcon:null,checked:!1,disabled:!1,variant:"default",onClick:void 0}},5191:e=>{e.exports={menuItem:"MenuItem_menuItem__L8VhH",disabled:"MenuItem_disabled__3U2GC",checked:"MenuItem_checked__WU4dX",danger:"MenuItem_danger__e7h6_",small:"MenuItem_small__Vif7y",large:"MenuItem_large___poLD",icon:"MenuItem_icon__hDsGM",trailingIcon:"MenuItem_trailingIcon__YsmTr",label:"MenuItem_label__OoNxS"}},6349:e=>{e.exports={container:"MentionDropdown_container__JsuwL",dropdown:"MentionDropdown_dropdown__5QGi8",message:"MentionDropdown_message__gzVMw"}},6732:(e,t,s)=>{"use strict";s.d(t,{d:()=>n});var a=s(5799);let n=()=>{let e={closeButton:!0,icon:!1};return{showToast:function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.oR)(t,{...e,...s})},showSuccessToast:function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.oR.success(t,{...e,autoClose:5e3,...s})},showErrorToast:function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.oR.error(t,{...e,autoClose:7e3,...s})},showWarningToast:function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.oR.warn(t,{...e,autoClose:7e3,...s})},showInfoToast:function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.oR.info(t,{...e,autoClose:5e3,...s})}}}},7055:(e,t,s)=>{"use strict";s.d(t,{J:()=>d,v:()=>i});var a=s(5155),n=s(2115),l=s(9644),o=s(2528);let r=(0,n.createContext)(null);function i(e){let{children:t}=e,{userPublicKey:s,altUsers:i}=(0,o.A)(),{getSingleProfile:d,getUsersStateless:c}=(0,l.P)(),[u,m]=(0,n.useState)(null),[p,h]=(0,n.useState)(!1),[g,_]=(0,n.useState)(null),[f,v]=(0,n.useState)(null),[y,x]=(0,n.useState)(!1),[b,j]=(0,n.useState)(null),w=(0,n.useCallback)(async()=>{if(!s){m(null),_(null);return}h(!0),_(null);try{let e=await d({PublicKeyBase58Check:s});e.success?m(e.data.Profile):(m(null),_(e.error))}catch(e){m(null),_((null==e?void 0:e.message)||"Error loading user profile")}finally{h(!1)}},[s,d]),P=(0,n.useCallback)(async()=>{if(!i||0===Object.keys(i).length){v(null),j(null);return}let e=Object.keys(i);x(!0),j(null);try{let t=await c({PublicKeysBase58Check:e,SkipForLeaderboard:!0});t.success?v(t.data.UserList):(v(null),j(t.error))}catch(e){v(null),j((null==e?void 0:e.message)||"Error loading alt users profiles")}finally{x(!1)}},[i,c]);return(0,n.useEffect)(()=>{w(),P()},[w,P]),(0,a.jsx)(r.Provider,{value:{userProfile:u,isUserProfileLoading:p,userProfileError:g,fetchUserProfile:w,altUserProfiles:f,isAltUserProfileSLoading:y,altUserProfilesError:b,fetchAltUserProfiles:P},children:t})}let d=()=>(0,n.useContext)(r)},7790:()=>{},8487:e=>{e.exports={post:"Post_post__dzBTG",postBody:"Post_postBody__UVCW9",postContentContainer:"Post_postContentContainer__eyzaF",header:"Post_header__zkLUs",replies:"Post_replies__QZOhl",username:"Post_username__qdB_S",displayName:"Post_displayName__7aoGG",publicKey:"Post_publicKey__Ma3iG",repost:"Post_repost__aAm8I",repostLabel:"Post_repostLabel__dMR5Y",body:"Post_body__Wr7n6",stats:"Post_stats__Wys7R",repliesContainer:"Post_repliesContainer__zefuK",repliesButton:"Post_repliesButton__aRf77",quote:"Post_quote__UhkqN",comment:"Post_comment__Exv6t",loadMoreButton:"Post_loadMoreButton__ekEkn",postLinkWrapper:"Post_postLinkWrapper__isGZn",postLink:"Post_postLink__vlDPq",postSummary:"Post_postSummary__FU6pP",postLinks:"Post_postLinks__BW9Ey",userLinksWrapper:"Post_userLinksWrapper__uHd_o",avatarContainer:"Post_avatarContainer__dsUNk",toggleRawButton:"Post_toggleRawButton__9G_ax",mobileAvatarContainer:"Post_mobileAvatarContainer__dSq_9",replyBox:"Post_replyBox__yjLxz",replyActions:"Post_replyActions__k4MLr",imageGallery:"Post_imageGallery__MC8ZG",postImage:"Post_postImage__p7jeI",videoGallery:"Post_videoGallery__BzLkR",postVideo:"Post_postVideo__seELc",postVideoIframe:"Post_postVideoIframe__xqvpj",repostDropdown:"Post_repostDropdown__4O2DB",iconWrapper:"Post_iconWrapper__RMRy5",repostIcon:"Post_repostIcon__Ddpjm",disabled:"Post_disabled__6sVmp",reposting:"Post_reposting__gv9BZ",fadePulse:"Post_fadePulse__ox1LK"}}}]);