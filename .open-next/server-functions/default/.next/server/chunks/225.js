exports.id=225,exports.ids=[225],exports.modules={11796:e=>{e.exports={container:"MentionDropdown_container__JsuwL",dropdown:"MentionDropdown_dropdown__5QGi8",message:"MentionDropdown_message__gzVMw"}},14999:e=>{e.exports={uploadContainer:"ImageUpload_uploadContainer__l4euf",hiddenFileInput:"ImageUpload_hiddenFileInput___uup2",uploadIconButton:"ImageUpload_uploadIconButton__W_vWF",smallUploadIconButton:"ImageUpload_smallUploadIconButton__yEclo",disabledUploadIconButton:"ImageUpload_disabledUploadIconButton__9_xxF",uploadIcon:"ImageUpload_uploadIcon__bWMUS",attachedImagesContainer:"ImageUpload_attachedImagesContainer__ypDmu",previewImageContainer:"ImageUpload_previewImageContainer__i3KyE",previewImage:"ImageUpload_previewImage__3idya",removeImageButton:"ImageUpload_removeImageButton__kbNbn",previewImagePlaceholder:"ImageUpload_previewImagePlaceholder__DS8SF",spinner:"ImageUpload_spinner__NzpzU",spin:"ImageUpload_spin__DPuLr",retryButton:"ImageUpload_retryButton___2jJV"}},17200:(e,t,s)=>{"use strict";s.d(t,{d:()=>r});var a=s(8222);let r=()=>{let e={closeButton:!0,icon:!1};return{showToast:(t,s={})=>(0,a.oR)(t,{...e,...s}),showSuccessToast:(t,s={})=>a.oR.success(t,{...e,autoClose:5e3,...s}),showErrorToast:(t,s={})=>a.oR.error(t,{...e,autoClose:7e3,...s}),showWarningToast:(t,s={})=>a.oR.warn(t,{...e,autoClose:7e3,...s}),showInfoToast:(t,s={})=>a.oR.info(t,{...e,autoClose:5e3,...s})}}},57164:e=>{e.exports={postContainer:"PostEditor_postContainer__v2b8J",commentContainer:"PostEditor_commentContainer__pxYgQ",postActions:"PostEditor_postActions__JS0yS",uploadActions:"PostEditor_uploadActions__OkWdD",actionButtons:"PostEditor_actionButtons__QEZva",error:"PostEditor_error__RvbQJ",commentBtn:"PostEditor_commentBtn__3lMi0",postButton:"PostEditor_postButton__iXF4l",textareaContainer:"PostEditor_textareaContainer__hoA1U"}},64940:(e,t,s)=>{"use strict";s.d(t,{L:()=>S});var a=s(60687),r=s(93679),o=s(8693),n=s(87394),l=s(85814),i=s.n(l),d=s(43210),c=s(90947),u=s(51462),p=s(75843),m=s(16189),h=s(31494),g=s(82373),f=s(18333),y=s(17200),_=s(1330),x=s(82336),v=s(4503),w=s(51865),P=s(19784),j=s(74606),b=s(39247),C=s(99086),I=s(69662),N=s.n(I),D=s(70682),U=s.n(D);let R=({post:e,username:t,ProfileEntryResponse:s,isStatsDisabled:n,onReply:l})=>{let{PostHashHex:c,CommentCount:u,LikeCount:p,DiamondCount:I,RepostCount:D,QuoteRepostCount:R}=e,L=(0,m.useRouter)(),[B,S]=(0,d.useState)(!1),[k,F]=(0,d.useState)(!1),[E,H]=(0,d.useState)(!1),[$,T]=(0,d.useState)(u),[M,A]=(0,d.useState)(D),[W,O]=(0,d.useState)(R);(0,d.useEffect)(()=>{T(u),A(D),O(R)},[u,D,R]);let{userPublicKey:Q,signAndSubmitTransaction:q}=(0,h.A)(),{userProfile:V}=(0,g.J)(),{setQuotedPost:z}=(0,f.h)(),{submitPost:G}=(0,r.P)(),{showErrorToast:K,showSuccessToast:J}=(0,y.d)(),Y=(0,o.useQueryClient)(),{refs:Z,floatingStyles:X}=(0,x.we)({placement:"bottom-start",strategy:"fixed",middleware:[(0,v.cY)(4),(0,v.UU)(),(0,v.BN)(),(0,v.Ej)({apply:({rects:e,elements:t})=>{Object.assign(t.floating.style,{width:`${e.reference.width}px`})}})],whileElementsMounted:w.ll});(0,P.L)([Z.reference,Z.floating],()=>{F(!1)});let ee=async()=>{H(!0),F(!1);try{let e=await G({UpdaterPublicKeyBase58Check:Q,RepostedPostHashHex:c,BodyObj:{},MinFeeRateNanosPerKB:1500});if(e.error||!e.data?.TransactionHex)throw Error(e.error||"Missing transaction hex");let t=await q(e.data.TransactionHex);if(t?.PostEntryResponse){let e=V?.Username||Q;await Y.invalidateQueries({queryKey:_.lH.userPosts(e)}),A(e=>e+1),J((0,a.jsxs)("div",{children:["Reposted successfully \uD83C\uDF89",(0,a.jsx)("br",{}),(0,a.jsx)(i(),{href:`/${e}/posts/`,children:"View in Posts"})]}),{autoClose:7e3})}else K("Error submitting repost.")}catch(t){let e=t?.message||"Error submitting repost";K(`Failed to submit repost. ${e}`)}finally{H(!1)}},et=async()=>{F(!1),z({post:e,username:t,ProfileEntryResponse:s}),L.push("/compose/post")};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:U().stats,children:[(0,a.jsxs)("span",{className:U().iconWrapper,children:[(0,a.jsx)("span",{onClick:Q&&!n?()=>{S(e=>!e)}:void 0,style:{cursor:Q&&!n?"pointer":"default"},title:Q?"Reply to this post":"Login to reply",children:"\uD83D\uDCAC"}),$]}),(0,a.jsxs)("span",{className:U().iconWrapper,children:[(0,a.jsx)("span",{ref:Z.setReference,onClick:Q&&!n&&!E&&(e?.Body||e?.ImageURLs||e?.VideoURLs)?()=>F(e=>!e):void 0,className:N()(U().repostIcon,{[U().reposting]:E,[U().disabled]:n||!Q||!e?.Body&&!e?.ImageURLs&&!e?.VideoURLs}),title:Q?e?.Body||e?.ImageURLs?.length||e?.VideoURLs?.length?"Repost options":"Can't repost empty post":"Login to repost",children:"\uD83D\uDD01"}),M+W]}),k&&(0,a.jsx)(x.XF,{children:(0,a.jsx)("div",{ref:Z.setFloating,style:X,className:U().dropdownContainer,children:(0,a.jsxs)(j.m,{className:U().repostDropdown,children:[(0,a.jsx)(b.D,{onClick:ee,children:"\uD83D\uDD01 Repost"}),(0,a.jsx)(b.D,{onClick:et,children:"\uD83D\uDCAD Quote"})]})})}),(0,a.jsxs)("span",{className:U().iconWrapper,children:[(0,a.jsx)("span",{children:"❤️"}),p]}),(0,a.jsxs)("span",{className:U().iconWrapper,children:[(0,a.jsx)("span",{children:"\uD83D\uDC8E"}),I]})]}),B&&(0,a.jsx)(C.g,{isComment:!0,ParentStakeID:c,onClose:()=>S(!1),onReply:e=>{T(e=>e+1),S(!1),l&&l(e)}})]})},L=({Body:e,VideoURLs:t,showRaw:s})=>{let r=e=>e.includes("iframe.videodelivery.net/"),o=e=>{try{let t=new URL(e);return"lvpr.tv"===t.hostname&&t.searchParams.has("v")}catch{return!1}},n=e=>{if(!e)return null;let t=e.match(/(?:youtube\.com\/(?:watch\?v=|shorts\/)|youtu\.be\/)([\w-]{11,})/);return t?t[1]:null},l=e=>{try{return new URL(e),!0}catch{return!1}},i=Array.from(new Set([...(e=>{let t;if(!e)return[];let s=/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:watch\?v=|shorts\/)|youtu\.be\/)([\w-]{11})/g,a=[];for(;t=s.exec(e);)a.push(t[1]);return a})(e),...(e=>Array.isArray(e)?e.map(n).filter(Boolean):[])(t)])),d=Array.isArray(t)?t.filter(e=>l(e)&&!n(e)):[];return(0,a.jsxs)(a.Fragment,{children:[!s&&(0,a.jsx)(a.Fragment,{children:i.length>0&&(0,a.jsx)("div",{className:U().videoGallery,children:i.map((e,t)=>(0,a.jsx)("iframe",{src:`https://www.youtube.com/embed/${e}`,className:U().postVideoIframe,allow:"accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;",allowFullScreen:!0,loading:"lazy",title:`YouTube Video ${t+1}`,style:{width:"100%",aspectRatio:"16/9",border:0}},e))})}),s&&t&&t.length>0&&(0,a.jsx)("div",{className:U().videoGallery,children:(0,a.jsx)("pre",{children:t.map(e=>`${e}
`).join("")})}),!s&&(0,a.jsx)(a.Fragment,{children:d&&d.length>0&&(0,a.jsx)("div",{className:U().videoGallery,children:d.map((e,t)=>r(e)||o(e)?(0,a.jsx)("iframe",{src:e,className:U().postVideoIframe,allow:"accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;",allowFullScreen:!0,loading:"lazy",title:`Video ${t+1}`,style:{width:"100%",aspectRatio:"16/9",border:0}},t):(0,a.jsx)("video",{src:e,controls:!0,className:U().postVideo,preload:"metadata",children:"Your browser does not support the video tag."},t))})})]})},B=({ImageURLs:e=[],showRaw:t=!1})=>e&&0!==e.length?(0,a.jsx)("div",{className:U().imageGallery,children:t?(0,a.jsx)("pre",{children:e.map(e=>`${e}
`).join("")}):(0,a.jsx)(a.Fragment,{children:e.map((e,t)=>(0,a.jsx)("img",{src:e,alt:`Post image ${t+1}`,className:U().postImage,loading:"lazy"},e||t))})}):null,S=({post:e,username:t,userProfile:s,isQuote:l,isComment:m,isStatsDisabled:h=!1})=>{if(!e)return null;let{PostHashHex:g,Body:f,ImageURLs:y,VideoURLs:x,CommentCount:v,RepostedPostEntryResponse:w,PosterPublicKeyBase58Check:P,ProfileEntryResponse:j,TimestampNanos:b}=e,{getSinglePost:C}=(0,r.P)(),I=(0,o.useQueryClient)(),N=(0,d.useRef)(!1),[D,k]=(0,d.useState)(()=>I.getQueryData(_.lT.rawVisible(g))??!1),F=t||j?.Username||P||"Unknown",E=(0,p.b)(F),H=!E&&F.startsWith("@")?F.slice(1):F,$=j?.ExtraData?.DisplayName||s?.ExtraData?.DisplayName,[T,M]=(0,d.useState)(()=>I.getQueryData(_.lT.commentsVisible(g))??!1),{data:A,fetchNextPage:W,hasNextPage:O,isFetchingNextPage:Q,isLoading:q,refetch:V}=(0,n.useInfiniteQuery)({queryKey:_.lH.postComments(g),queryFn:async({pageParam:e=0})=>{let t=await C({PostHashHex:g,CommentOffset:e,CommentLimit:10});if(!t.success)throw Error(t.error||"Failed to fetch comments");let s=t.data?.PostFound?.Comments||[],a=I.getQueryData(_.lH.postComments(g)),r=new Set(a?.pages.flatMap(e=>e.comments.map(e=>e.PostHashHex))||[]);return{comments:s.filter(e=>!r.has(e.PostHashHex)),nextOffset:e+10,hasMore:10===s.length}},getNextPageParam:(e,t)=>{let s=t[0]?.comments?.filter(e=>e.isLocal||e.isPromoted)?.length||0,a=t.flatMap(e=>e.comments).length-s;return e.hasMore?a:void 0},enabled:T,staleTime:1/0,gcTime:1/0,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1,retry:!1}),z=A?.pages.flatMap(e=>e.comments)||[],G=(I.getQueryData(_.lT.newCommentsVisible(g))??!0)&&A?.pages?.[0]?.comments?.filter(e=>e.isLocal)||[];return(0,a.jsxs)("div",{className:`${U().post} ${l?U().quote:""} ${m?U().comment:""}`,children:[!m&&(0,a.jsx)("div",{className:U().avatarContainer,children:(0,a.jsx)(u.e,{profile:j||s,size:48})}),(0,a.jsxs)("div",{className:U().postContentContainer,children:[(0,a.jsxs)("div",{className:U().header,children:[m?(0,a.jsx)(u.e,{profile:j||s,size:40}):(0,a.jsx)("div",{className:U().mobileAvatarContainer,children:(0,a.jsx)(u.e,{profile:j||s,size:45})}),(0,a.jsxs)("div",{className:U().postSummary,children:[(0,a.jsxs)("div",{className:U().postLinks,children:[(0,a.jsxs)("div",{className:U().userLinksWrapper,children:[$&&(0,a.jsx)(i(),{href:`/${H}`,className:U().displayName,prefetch:!1,children:$}),E?(0,a.jsx)(i(),{href:`/${H}`,className:U().publicKey,prefetch:!1,children:H}):(0,a.jsxs)(i(),{href:`/${H}`,className:U().username,prefetch:!1,children:["@",H]})]}),(0,a.jsx)("div",{className:U().postLinkWrapper,children:(0,a.jsxs)(i(),{href:`/${H}/posts/${g}`,className:U().postLink,prefetch:!1,children:[b&&(0,a.jsxs)(a.Fragment,{children:[function(e){if(null==e||isNaN(Number(e)))return"Invalid date";let t=Number(e);if(!isFinite(t)||Math.abs(t)>864e19)return"Invalid date";let s=new Date(Math.floor(t/1e6));if(isNaN(s.getTime())||1970>s.getFullYear()||s.getFullYear()>3e3)return"Invalid date";try{let e=s.toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});return e=e.replace(",","")}catch(e){return s.toISOString().replace("T",", ").replace(/\.\d+Z$/,"")}}(b),". "]}),g]})})]}),(0,a.jsx)("div",{className:U().postControls,children:(f||y&&y.length>0)&&(0,a.jsx)("button",{onClick:()=>{k(e=>{let t=!e;return I.setQueryData(_.lT.rawVisible(g),t),t})},className:U().toggleRawButton,children:D?"Show Rendered \uD83D\uDCC4":"Show Raw \uD83D\uDCDD"})})]})]}),f&&(0,a.jsx)("div",{className:U().postBody,children:D?(0,a.jsx)("pre",{children:f.replace(/\\/g,"\\\\")}):(0,a.jsx)(c.R,{text:f})}),(0,a.jsx)(B,{ImageURLs:y,showRaw:D}),(0,a.jsx)(L,{Body:f,VideoURLs:x,showRaw:D}),w&&(0,a.jsx)("div",{className:U().repost,children:(0,a.jsx)(S,{post:w,isQuote:!0,isStatsDisabled:h})}),(0,a.jsx)(R,{post:e,username:t,ProfileEntryResponse:s,isStatsDisabled:h,onReply:e=>{T||(N.current=!0);let t={...e,isLocal:!0};I.setQueryData(_.lH.postComments(g),e=>{if(!e)return{pages:[{comments:[t]}],pageParams:[null]};if(e.pages.some(e=>e.comments.some(e=>e.PostHashHex===t.PostHashHex)))return e;let s=e.pages[0];return{...e,pages:[{...s,comments:[t,...s.comments]},...e.pages.slice(1)]}})}}),!h&&(0,a.jsxs)(a.Fragment,{children:[v>0&&(0,a.jsx)("button",{onClick:()=>{let e=!T;if(I.setQueryData(_.lT.commentsVisible(g),e),e&&I.setQueryData(_.lT.newCommentsVisible(g),!0),M(e),!e){I.setQueryData(_.lH.postComments(g),e=>{if(!e)return;let t=e.pages[0],s=t.comments.filter(e=>e.isLocal),a=t.comments.filter(e=>!e.isLocal),r=[...s.map(e=>({...e,isLocal:void 0,isPromoted:!0})),...a];return{...e,pages:[{...t,comments:r},...e.pages.slice(1)]}});return}if(N.current){N.current=!1;let e=I.getQueryData(_.lH.postComments(g)),t=e?.pages?.[0]?.comments||[],s=t.filter(e=>e.isLocal);if(t.some(e=>!e.isLocal&&!e.isPromoted))I.setQueryData(_.lH.postComments(g),e=>{if(!e)return;let t=e.pages[0],s=t.comments.filter(e=>e.isLocal),a=t.comments.filter(e=>!e.isLocal),r=[...s.map(e=>({...e,isLocal:void 0,isPromoted:!0})),...a];return{...e,pages:[{...t,comments:r},...e.pages.slice(1)]}});else{let e=t.filter(e=>e.isPromoted);V().then(()=>{I.setQueryData(_.lH.postComments(g),t=>{if(!t)return;let a=new Set(t.pages.flatMap(e=>e.comments.map(e=>e.PostHashHex))),r=[...s.filter(e=>!a.has(e.PostHashHex)).map(e=>({...e,isLocal:void 0,isPromoted:!0})),...e.filter(e=>!a.has(e.PostHashHex)),...t.pages[0].comments];return{...t,pages:[{...t.pages[0],comments:r},...t.pages.slice(1)]}})})}}},className:U().repliesButton,children:q?"Loading replies...":T?"Hide replies":"See replies..."}),!T&&G.length>0&&(0,a.jsx)("div",{className:U().repliesContainer,children:(0,a.jsx)("div",{className:U().replies,children:G.map(e=>(0,a.jsx)(S,{post:e,isComment:!0},e.PostHashHex))})}),T&&(0,a.jsxs)("div",{className:U().repliesContainer,children:[(0,a.jsx)("div",{className:U().replies,children:z.map(e=>(0,a.jsx)(S,{post:e,isComment:!0},e.PostHashHex))}),O&&(0,a.jsx)("button",{onClick:W,disabled:Q,className:U().loadMoreButton,children:Q?"Loading more...":"Load more replies"})]})]})]})]})}},70682:e=>{e.exports={post:"Post_post__dzBTG",postBody:"Post_postBody__UVCW9",postContentContainer:"Post_postContentContainer__eyzaF",header:"Post_header__zkLUs",replies:"Post_replies__QZOhl",username:"Post_username__qdB_S",displayName:"Post_displayName__7aoGG",publicKey:"Post_publicKey__Ma3iG",repost:"Post_repost__aAm8I",repostLabel:"Post_repostLabel__dMR5Y",body:"Post_body__Wr7n6",stats:"Post_stats__Wys7R",repliesContainer:"Post_repliesContainer__zefuK",repliesButton:"Post_repliesButton__aRf77",quote:"Post_quote__UhkqN",comment:"Post_comment__Exv6t",loadMoreButton:"Post_loadMoreButton__ekEkn",postLinkWrapper:"Post_postLinkWrapper__isGZn",postLink:"Post_postLink__vlDPq",postSummary:"Post_postSummary__FU6pP",postLinks:"Post_postLinks__BW9Ey",userLinksWrapper:"Post_userLinksWrapper__uHd_o",avatarContainer:"Post_avatarContainer__dsUNk",toggleRawButton:"Post_toggleRawButton__9G_ax",mobileAvatarContainer:"Post_mobileAvatarContainer__dSq_9",replyBox:"Post_replyBox__yjLxz",replyActions:"Post_replyActions__k4MLr",imageGallery:"Post_imageGallery__MC8ZG",postImage:"Post_postImage__p7jeI",videoGallery:"Post_videoGallery__BzLkR",postVideo:"Post_postVideo__seELc",postVideoIframe:"Post_postVideoIframe__xqvpj",repostDropdown:"Post_repostDropdown__4O2DB",iconWrapper:"Post_iconWrapper__RMRy5",repostIcon:"Post_repostIcon__Ddpjm",disabled:"Post_disabled__6sVmp",reposting:"Post_reposting__gv9BZ",fadePulse:"Post_fadePulse__ox1LK"}},99086:(e,t,s)=>{"use strict";s.d(t,{g:()=>$});var a=s(60687),r=s(43210),o=s(85814),n=s.n(o),l=s(31494),i=s(82373),d=s(93679),c=s(17200),u=s(8693),p=s(1330),m=s(5776),h=s(64940),g=s(86751),f=s(69662),y=s.n(f),_=s(14999),x=s.n(_);let v=({onImageUpload:e,disabled:t=!1,size:s})=>(0,a.jsx)("div",{className:x().uploadContainer,children:(0,a.jsxs)("label",{className:y()(x().uploadIconButton,{[x().disabledUploadIconButton]:t,[x().smallUploadIconButton]:"small"===s}),children:[(0,a.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e,disabled:t,className:x().hiddenFileInput}),(0,a.jsx)(g.To,{className:x().uploadIcon})]})}),w=({uploadedImages:e,onRetryUpload:t,onRemoveImage:s})=>0===e.length?null:(0,a.jsx)("div",{className:x().attachedImagesContainer,children:e.map(e=>(0,a.jsxs)("div",{className:x().previewImageContainer,children:["success"===e.status&&e.url&&(0,a.jsx)("img",{src:e.url,alt:`Uploaded image ${e.id}`,className:x().previewImage}),"uploading"===e.status&&(0,a.jsx)("div",{className:x().previewImagePlaceholder,children:(0,a.jsx)("div",{className:x().spinner})}),"error"===e.status&&(0,a.jsx)("div",{className:x().previewImagePlaceholder,children:(0,a.jsx)("button",{className:x().retryButton,onClick:()=>t(e),title:e.errorMessage?`Error: ${e.errorMessage}
Click to retry`:"Click to retry",children:"\uD83D\uDD01"})}),(0,a.jsx)("button",{onClick:()=>s(e.id),className:x().removeImageButton,title:"Remove image",disabled:"uploading"===e.status,children:"✕"})]},e.id))}),P=({userPublicKey:e,getJWT:t})=>{let[s,a]=(0,r.useState)(!1),[o,n]=(0,r.useState)([]),{uploadImage:l}=(0,d.P)(),{showErrorToast:i}=(0,c.d)(),u=o.filter(e=>"success"===e.status).map(e=>e.url),p=async s=>{if(!s.length)return;let r=s.map(e=>({id:crypto.randomUUID(),file:e,url:null,status:"uploading",errorMessage:null}));n(e=>[...e,...r]);let o=await t();if(!o||!e){i("Missing auth data. Please login again.");return}a(!0);let d=await Promise.allSettled(r.map(async t=>{try{let s=await l({imageFile:t.file,userPublicKey:e,jwt:o});return n(e=>e.map(e=>e.id===t.id?s.success?{...e,url:s.data.ImageURL,status:"success"}:{...e,status:"error",errorMessage:s.error||"Upload failed"}:e)),{success:s.success,fileName:t.file.name,error:s.error}}catch(s){let e=s?.message||"Upload failed";return n(s=>s.map(s=>s.id===t.id?{...s,status:"error",errorMessage:e}:s)),{success:!1,fileName:t.file.name,error:e}}}));a(!1);let c=d.map(e=>e.value).filter(e=>e&&!e.success);if(c.length>0){if(1===c.length){let e=c[0];i(`Failed to upload "${e.fileName}": ${e.error}`)}else i(`Failed to upload ${c.length} image${c.length>1?"s":""}`)}};return{imageLoading:s,uploadedImages:o,successfulImageUrls:u,handleImageUpload:async e=>{let t=Array.from(e.target.files||[]);e.target.value="",await p(t)},handlePaste:async e=>{let t=e.clipboardData?.items;if(!t)return;let s=Array.from(t).filter(e=>"file"===e.kind&&e.type.startsWith("image/"));if(s.length>0){let e=s.map(e=>e.getAsFile()).filter(Boolean);await p(e)}},handlePastedText:async e=>{let t=e.trim();if(/^https?:\/\/.*\.(gif|webp)(\?.*)?$/i.test(t)||/tenor\.com|giphy\.com|media\.discordapp\.net/i.test(t))try{let e=await fetch(t);if(!e.ok){i("Failed to download GIF");return}let s=await e.blob();if(!s.type.startsWith("image/")){i("URL does not contain a valid image");return}let a=`gif-${Date.now()}.${s.type.split("/")[1]||"gif"}`,r=new File([s],a,{type:s.type});await p([r])}catch(e){console.error("Error downloading GIF:",e),i("Failed to download GIF from URL")}},handleDrop:async e=>{e.preventDefault();let t=Array.from(e.dataTransfer.files).filter(e=>e.type.startsWith("image/"));t.length>0&&await p(t)},handleDragOver:e=>{e.preventDefault()},handleRetryUpload:async s=>{n(e=>e.map(e=>e.id===s.id?{...e,status:"uploading"}:e));let a=await t();try{let t=await l({imageFile:s.file,userPublicKey:e,jwt:a});if(t.success)n(e=>e.map(e=>e.id===s.id?{...e,url:t.data.ImageURL,status:"success",errorMessage:null}:e));else{let e=t.error||"Retry failed";n(t=>t.map(t=>t.id===s.id?{...t,status:"error",errorMessage:e}:t)),i(`Retry failed for "${s.file.name}": ${e}`)}}catch(t){let e=t?.message||"Retry failed";n(t=>t.map(t=>t.id===s.id?{...t,status:"error",errorMessage:e}:t)),i(`Retry failed for "${s.file.name}": ${e}`)}},handleRemoveImage:e=>{n(t=>t.filter(t=>t.id!==e))},loadExistingImages:e=>{if(!e?.length){n([]);return}n(e.map(e=>({id:crypto.randomUUID(),file:null,url:e,status:"success",errorMessage:null})))},clearImages:()=>{n([])}}};var j=s(12030),b=s(82336),C=s(4503),I=s(51865),N=s(19784);let D=(e,t)=>{let s=document.createElement("div"),a=window.getComputedStyle(e);s.style.position="absolute",s.style.visibility="hidden",s.style.whiteSpace="pre-wrap",s.style.wordWrap="break-word",s.style.width=e.offsetWidth+"px",s.style.font=a.font,s.style.padding=a.padding,s.style.border=a.border,s.style.lineHeight=a.lineHeight,s.style.letterSpacing=a.letterSpacing,document.body.appendChild(s),s.textContent=e.value.substring(0,t);let r=document.createElement("span");r.textContent="|",s.appendChild(r);let o={top:r.offsetTop,left:r.offsetLeft};return document.body.removeChild(s),o},U=e=>{let[t,s]=(0,r.useState)({isOpen:!1,query:"",startIndex:-1,endIndex:-1}),[a,o]=(0,r.useState)(0),[n,l]=(0,r.useState)(""),i=(0,r.useRef)(t);(0,r.useEffect)(()=>{i.current=t},[t]);let c=(0,r.useRef)({getBoundingClientRect:()=>{let t=i.current;if(!e.current||!t.isOpen||-1===t.startIndex)return{width:0,height:0,x:0,y:0,top:0,left:0,right:0,bottom:0};let s=e.current,a=s.getBoundingClientRect(),r=D(s,t.startIndex),o=r.top-s.scrollTop,n=r.left-s.scrollLeft,l=a.top+o,d=a.left+n;return{width:0,height:0,x:d,y:l,top:l,left:d,right:d,bottom:l}}}),{getProfiles:u}=(0,d.P)(),m=(0,r.useCallback)(()=>{s({isOpen:!1,query:"",startIndex:-1,endIndex:-1})},[]),{refs:h,floatingStyles:g}=(0,b.we)({placement:"bottom-start",middleware:[(0,C.cY)(({placement:e})=>({mainAxis:25*!!e.startsWith("bottom"),crossAxis:0})),(0,C.UU)({mainAxis:!0,padding:8}),(0,C.BN)(),(0,C.Ej)({apply:({elements:e})=>{Object.assign(e.floating.style,{maxHeight:"200px",minWidth:"250px",overflowY:"auto"})}})],whileElementsMounted:I.ll});(0,r.useEffect)(()=>{let s=e.current;if(!s)return;let a=()=>{t.isOpen&&m()};return s.addEventListener("scroll",a),()=>s.removeEventListener("scroll",a)},[e,t.isOpen,m]),(0,N.L)([h.floating],()=>{t.isOpen&&m()}),(0,r.useEffect)(()=>{let e=setTimeout(()=>{t.query.length>=2?l(t.query):l("")},300);return()=>clearTimeout(e)},[t.query]);let{data:f=[],isLoading:y}=(0,j.useQuery)({queryKey:p.lH.searchProfilesByUsernamePrefix(n),queryFn:async()=>{let e=await u({UsernamePrefix:n,AddGlobalFeedBoolean:!1,FetchUsersThatHODL:!1,NumToFetch:8});if(!e.success)throw Error(e.error);return e.data?.ProfilesFound||[]},enabled:!!n&&t.isOpen,staleTime:3e4,gcTime:3e5,retry:!1,refetchOnWindowFocus:!1});(0,r.useEffect)(()=>{o(0)},[f]);let _=(0,r.useCallback)((e,t)=>{let s=e.slice(0,t),a=s.match(/@([a-zA-Z0-9_]*)$/);if(a){let e=a[1],r=s.lastIndexOf("@");return{isOpen:e.length>=2,query:e,startIndex:r,endIndex:t}}return{isOpen:!1,query:"",startIndex:-1,endIndex:-1}},[]),x=(0,r.useCallback)((e,t)=>{let a=_(e,t);s(a),a.isOpen&&h.setReference(c.current)},[_,h]),v=(0,r.useCallback)((s,a,r)=>{if(!s||-1===t.startIndex)return;let o=a.slice(0,t.startIndex),n=a.slice(t.endIndex);r(`${o}@${s.Username} ${n}`),m(),setTimeout(()=>{if(e.current){let t=o.length+s.Username.length+2;e.current.focus(),e.current.setSelectionRange(t,t)}},0)},[t,e,m]),w=(0,r.useCallback)((e,s,r)=>{if(!t.isOpen||0===f.length)return!1;switch(e.key){case"ArrowDown":return e.preventDefault(),o(e=>Math.min(e+1,f.length-1)),!0;case"ArrowUp":return e.preventDefault(),o(e=>Math.max(e-1,0)),!0;case"Enter":case"Tab":return e.preventDefault(),f[a]&&v(f[a],s,r),!0;case"Escape":return e.preventDefault(),m(),!0;default:return!1}},[t.isOpen,f,a,v,m]);return{mentionState:t,profiles:f,isLoading:y,selectedIndex:a,setSelectedIndex:o,handleTextChange:x,handleKeyDown:w,insertMention:v,closeMentions:m,floatingStyles:g,refs:h}};var R=s(51462),L=s(74606),B=s(39247),S=s(11796),k=s.n(S);let F=({isOpen:e,profiles:t,isLoading:s,selectedIndex:r,floatingStyles:o,floatingRef:n,onSelect:l,onHover:i})=>e?(0,a.jsx)(b.XF,{children:(0,a.jsx)("div",{ref:n,style:o,className:k().container,children:(0,a.jsx)(L.m,{className:k().dropdown,children:s?(0,a.jsx)("div",{className:k().message,children:"Searching..."}):t.length>0?t.map((e,t)=>(0,a.jsx)("div",{onMouseEnter:()=>i(t),children:(0,a.jsxs)(B.D,{onClick:()=>l(e),checked:t===r,icon:(0,a.jsx)(R.e,{profile:e,size:24}),children:["@",e.Username]})},e.PublicKeyBase58Check)):(0,a.jsx)("div",{className:k().message,children:"No users found"})})})}):null;var E=s(57164),H=s.n(E);let $=({mode:e="create",quotedPost:t=null,editablePost:s=null,disabled:o=!1,userPublicKey:g=null,userProfile:f=null,ParentStakeID:_=null,isComment:x=!1,onReply:j,onClose:b})=>{let C=(0,l.A)(),I=(0,i.J)(),N=g||C.userPublicKey,D=f||I.userProfile,R=C.signAndSubmitTransaction,{submitPost:L}=(0,d.P)(),{showErrorToast:B,showSuccessToast:S}=(0,c.d)(),k=(0,u.useQueryClient)(),[E,$]=(0,r.useState)(""),[T,M]=(0,r.useState)(!1),A=(0,r.useRef)(null),{imageLoading:W,uploadedImages:O,successfulImageUrls:Q,handleImageUpload:q,handlePaste:V,handleDrop:z,handleDragOver:G,handleRetryUpload:K,handleRemoveImage:J,loadExistingImages:Y,clearImages:Z}=P({userPublicKey:N,getJWT:C.getIdentityJWT}),{mentionState:X,profiles:ee,isLoading:et,selectedIndex:es,setSelectedIndex:ea,handleTextChange:er,handleKeyDown:eo,insertMention:en,closeMentions:el,floatingStyles:ei,refs:ed}=U(A);(0,r.useEffect)(()=>{"quote"===e&&t?($(""),Z()):"edit"===e&&s?($(s.Body||""),Y(s.ImageURLs)):($(""),Z())},[e,t,s]);let ec=e=>{$(e)},eu=async()=>{M(!0);try{let r={UpdaterPublicKeyBase58Check:N,...x&&_&&{ParentStakeID:_},..."quote"===e&&t&&{RepostedPostHashHex:t?.post?.PostHashHex},..."edit"===e&&s&&{PostHashHexToModify:s.PostHashHex},BodyObj:{Body:E,...Q.length>0&&{ImageURLs:Q}},MinFeeRateNanosPerKB:1500},o=await L(r);if(o.error){B(`Failed to submit post: ${o.error}`);return}if(o.success&&o.data?.TransactionHex){let t=D?.Username||N,s=await R(o.data.TransactionHex);x||await k.invalidateQueries({queryKey:p.lH.userPosts(t)}),x||S((0,a.jsxs)("div",{children:[(()=>{switch(e){case"quote":return"Quote posted successfully \uD83C\uDF89";case"edit":return"Post updated successfully ✨";default:return"Post published successfully \uD83C\uDF89"}})(),(0,a.jsx)("br",{}),(0,a.jsx)(n(),{href:`/${t}/posts/`,children:"View in Posts"})]}),{autoClose:7e3}),$(""),Z(),el(),j&&j(s?.PostEntryResponse),b&&b()}}catch(t){let e=t?.message||"Error submitting post";B(`Failed to submit post: ${e}`)}finally{M(!1)}},ep=()=>N?T?x?"Posting...":"quote"===e?"Quoting...":"edit"===e?"Updating...":"Posting...":x?"Reply":"quote"===e?"Quote Post":"edit"===e?"Update Post":"Post to DeSo":"Login to Post";return(0,a.jsxs)("div",{className:y()(H().postContainer,{[H().commentContainer]:x}),children:[(0,a.jsxs)("div",{className:H().textareaContainer,children:[(0,a.jsx)("textarea",{ref:A,name:x?"commentText":"postText",disabled:T||o||!N,value:E,onChange:e=>{let t=e.target.value,s=e.target.selectionStart;$(t),er(t,s)},onKeyDown:e=>{if(eo(e,E,ec))return},onSelect:e=>{er(E,e.target.selectionStart)},onPaste:V,onDrop:z,onDragOver:G,placeholder:(()=>{if(!N)return"Login to start posting...";let t=D?.Username||N;return x?`Reply as ${t}...`:"quote"===e?`Add your thoughts about this post as ${t}...`:"edit"===e?`Edit your post as ${t}...`:`Write a post as ${t}...`})()}),(0,a.jsx)(F,{isOpen:X.isOpen,profiles:ee,isLoading:et,selectedIndex:es,floatingStyles:ei,floatingRef:ed.setFloating,onSelect:e=>{en(e,E,ec)},onHover:ea})]}),(0,a.jsxs)("div",{className:H().postActions,children:[(0,a.jsx)("div",{className:H().uploadActions,children:(0,a.jsx)(v,{onImageUpload:q,disabled:!N,size:x?"small":void 0})}),x?(0,a.jsxs)("div",{className:H().actionButtons,children:[(0,a.jsx)(m.$,{onClick:b,disabled:T,variant:"secondary",size:"small",className:H().commentBtn,children:"Cancel"}),(0,a.jsx)(m.$,{onClick:eu,isLoading:T,disabled:!E.trim()&&0===O.filter(e=>e.url).length||o||!N||W,variant:"primary",size:"small",className:H().commentBtn,children:ep()})]}):(0,a.jsx)("div",{className:H().actionButtons,children:(0,a.jsx)(m.$,{disabled:!E.trim()&&0===O.filter(e=>e.url).length||o||!N||W,isLoading:T,onClick:eu,className:H().postButton,children:ep()})})]}),(0,a.jsx)(w,{uploadedImages:O,onRetryUpload:K,onRemoveImage:J}),t&&(0,a.jsx)(h.L,{post:t?.post,username:t?.username,userProfile:t?.ProfileEntryResponse,isQuote:!0,isStatsDisabled:!0})]})}}};